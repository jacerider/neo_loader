{"version":3,"file":"loader.js","sources":["../../../../../../modules/contrib/neo_loader/src/js/loader.ts"],"sourcesContent":["(function (Drupal, drupalSettings) {\n\n  type LoaderType =\n    | 'fullscreen'\n    | 'throbber';\n\n  let fullyLoaded = false;\n  let waitTimer:ReturnType<typeof setTimeout>|null = null;\n\n  Drupal.behaviors.neoLoader = {\n\n    show: (message:string, type:LoaderType, selector:HTMLElement|string, delay:number) => {\n      type = type || 'fullscreen';\n      selector = selector || 'body';\n      delay = delay || 1000;\n      if (typeof drupalSettings.neoLoader !== 'undefined' && typeof drupalSettings.neoLoader.markup !== 'undefined') {\n        const loader = document.createElement('div');\n        loader.classList.add('ajax-progress');\n        loader.classList.add('ajax-progress-' + type);\n        loader.innerHTML = drupalSettings.neoLoader.markup;\n        if (message) {\n          const messageElement = document.createElement('div');\n          messageElement.classList.add('message');\n          messageElement.textContent = message;\n          loader.querySelector('.neo-loader')?.appendChild(messageElement);\n        }\n        if (selector) {\n          const position = typeof selector === 'string' ? document.querySelector(selector) : selector;\n          if (position) {\n            if (type === 'fullscreen') {\n              position.appendChild(loader);\n            }\n            else {\n              let closest = position.closest('.js-form-item, form');\n              if (closest) {\n                closest.classList.add('ajax-progress-wrapper');\n              }\n              position.after(loader);\n            }\n            waitTimer = setTimeout(() => {\n              fullyLoaded = false;\n              const transitionCallback = (e:Event) => {\n                const target = e.target as HTMLElement;\n                if (target.classList.contains('ajax-progress')) {\n                  fullyLoaded = true;\n                }\n              };\n              loader.addEventListener('transitionend', transitionCallback);\n              loader.classList.add('active');\n            }, delay);\n            return loader;\n          }\n        }\n      }\n      return null;\n    },\n\n    hide: (callback:Function) => {\n      if (waitTimer) {\n        clearTimeout(waitTimer);\n      }\n      const loader = document.querySelector<HTMLElement>('.ajax-progress');\n      if (loader) {\n        if (loader.classList.contains('active')) {\n          const checkFullyLoaded = setInterval(() => {\n            if (fullyLoaded) {\n              clearInterval(checkFullyLoaded);\n              const transitionCallback = (e:Event) => {\n                const target = e.target as HTMLElement;\n                if (target.classList.contains('ajax-progress')) {\n                  loader.remove();\n                  if (callback) {\n                    callback();\n                  }\n                }\n              };\n              loader.addEventListener('transitionend', transitionCallback);\n              loader.classList.remove('active');\n            }\n          }, 100);\n        }\n        else {\n          loader.remove();\n          if (callback) {\n            callback();\n          }\n        }\n        return loader;\n      }\n      return null;\n    }\n  };\n\n})(Drupal, drupalSettings);\n\nexport {};\n"],"names":["Drupal","drupalSettings","fullyLoaded","waitTimer","message","type","selector","delay","_a","loader","messageElement","position","closest","transitionCallback","e","callback","checkFullyLoaded"],"mappings":"CAAC,SAAUA,GAAQC,GAAgB;AAMjC,MAAIC,IAAc,IACdC,IAA+C;AAEnDH,EAAAA,EAAO,UAAU,YAAY;AAAA,IAE3B,MAAM,CAACI,GAAgBC,GAAiBC,GAA6BC,MAAiB;AAXzF,UAAAC;AAeS,UAHJH,IAAOA,KAAQ,cACfC,IAAWA,KAAY,QACvBC,IAAQA,KAAS,KACb,OAAON,EAAe,YAAc,OAAe,OAAOA,EAAe,UAAU,SAAW,KAAa;AACvG,cAAAQ,IAAS,SAAS,cAAc,KAAK;AAI3C,YAHOA,EAAA,UAAU,IAAI,eAAe,GAC7BA,EAAA,UAAU,IAAI,mBAAmBJ,CAAI,GACrCI,EAAA,YAAYR,EAAe,UAAU,QACxCG,GAAS;AACL,gBAAAM,IAAiB,SAAS,cAAc,KAAK;AACpC,UAAAA,EAAA,UAAU,IAAI,SAAS,GACtCA,EAAe,cAAcN,IAC7BI,IAAAC,EAAO,cAAc,aAAa,MAAlC,QAAAD,EAAqC,YAAYE;AAAA,QAAc;AAEjE,YAAIJ,GAAU;AACZ,gBAAMK,IAAW,OAAOL,KAAa,WAAW,SAAS,cAAcA,CAAQ,IAAIA;AACnF,cAAIK,GAAU;AACZ,gBAAIN,MAAS;AACX,cAAAM,EAAS,YAAYF,CAAM;AAAA,iBAExB;AACC,kBAAAG,IAAUD,EAAS,QAAQ,qBAAqB;AACpD,cAAIC,KACMA,EAAA,UAAU,IAAI,uBAAuB,GAE/CD,EAAS,MAAMF,CAAM;AAAA,YAAA;AAEvB,mBAAAN,IAAY,WAAW,MAAM;AACb,cAAAD,IAAA;AACR,oBAAAW,IAAqB,CAACC,MAAY;AAEtC,gBADeA,EAAE,OACN,UAAU,SAAS,eAAe,MAC7BZ,IAAA;AAAA,cAElB;AACO,cAAAO,EAAA,iBAAiB,iBAAiBI,CAAkB,GACpDJ,EAAA,UAAU,IAAI,QAAQ;AAAA,eAC5BF,CAAK,GACDE;AAAA,UAAA;AAAA,QACT;AAAA,MACF;AAEK,aAAA;AAAA,IACT;AAAA,IAEA,MAAM,CAACM,MAAsB;AAC3B,MAAIZ,KACF,aAAaA,CAAS;AAElB,YAAAM,IAAS,SAAS,cAA2B,gBAAgB;AACnE,UAAIA,GAAQ;AACV,YAAIA,EAAO,UAAU,SAAS,QAAQ,GAAG;AACjC,gBAAAO,IAAmB,YAAY,MAAM;AACzC,gBAAId,GAAa;AACf,4BAAcc,CAAgB;AACxB,oBAAAH,IAAqB,CAACC,MAAY;AAEtC,gBADeA,EAAE,OACN,UAAU,SAAS,eAAe,MAC3CL,EAAO,OAAO,GACVM,KACOA,EAAA;AAAA,cAGf;AACO,cAAAN,EAAA,iBAAiB,iBAAiBI,CAAkB,GACpDJ,EAAA,UAAU,OAAO,QAAQ;AAAA,YAAA;AAAA,aAEjC,GAAG;AAAA,QAAA;AAGN,UAAAA,EAAO,OAAO,GACVM,KACOA,EAAA;AAGN,eAAAN;AAAA,MAAA;AAEF,aAAA;AAAA,IAAA;AAAA,EAEX;AAEF,GAAG,QAAQ,cAAc;"}